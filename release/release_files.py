#!/usr/bin/env python3
import os
import re
from pathlib import Path

HERE = os.path.abspath(os.path.dirname(__file__))
ROOT = HERE + "/.."

# blacklisting is for two purposes:
# - minimizing release download size
# - keeping the diff readable
blacklist = [
  "^scripts/",
  "body/STL/",
  "tools/cabana/",
  "panda/examples/",
  "opendbc/generator/",

  "^tools/",
  "^tinygrad_repo/",

  "matlab.*.md",

  ".git$",  # for submodules
  ".git/",
  ".github/",
  ".devcontainer/",
  "Darwin/",
  ".vscode/",

  # no LFS
  ".lfsconfig",
  ".gitattributes",
]

# Sunnypilot blacklist
sunnypilot_blacklist = [
  ".idea/",
  ".run/",
  ".run/",
  "release/ci/scons_cache/",
  "system/loggerd/sunnylink_uploader.py",  # Temporarily, until we are ready to roll it out widely
  ".gitlab-ci.yml",
  ".clang-tidy",
  ".dockerignore",
  ".editorconfig",
  ".gitmodules",
  ".pre-commit-config.yaml",
  ".python-version",
  ".dockerignore",
  ".editorconfig",
  ".gitlab-ci.yml",
  ".gitmodules",
  ".pre-commit-config.yaml",
  ".python-version",
  "body/.pre-commit-config.yaml",
  "body/board/canloader.py",
  "body/board/flash_base.sh",
  "body/board/flash_knee.sh",
  "body/board/recover.sh",
  "body/Dockerfile",
  "body/LICENSE",
  "body/pyproject.toml",
  "body/README.md",
  "body/requirements.txt",
  "body/SConstruct",
  "cereal/.dockerignore",
  "cereal/.pre-commit-config.yaml",
  "cereal/codecov.yml",
  "cereal/Dockerfile",
  "cereal/generate_javascript.sh",
  "cereal/LICENSE",
  "cereal/maptile.capnp",
  "cereal/messaging/demo.py",
  "cereal/messaging/msgq.md",
  "cereal/messaging/stress.py",
  "cereal/messaging/test_runner",
  "cereal/messaging/tests/",
  "cereal/messaging/tests/__init__.py",
  "cereal/messaging/tests/test_fake.py",
  "cereal/messaging/tests/test_messaging.py",
  "cereal/messaging/tests/test_poller.py",
  "cereal/messaging/tests/test_pub_sub_master.py",
  "cereal/messaging/tests/test_services.py",
  "cereal/pyproject.toml",
  "cereal/README.md",
  "cereal/SConstruct",
  "cereal/site_scons/",
  "cereal/site_scons/site_tools/",
  "cereal/site_scons/site_tools/cython.py",
  "cereal/visionipc/test_runner",
  "cereal/visionipc/tests/",
  "cereal/visionipc/tests/__init__.py",
  "cereal/visionipc/tests/test_visionipc.py",
  "codecov.yml",
  "common/tests/",
  "common/tests/__init__.py",
  "common/tests/.gitignore",
  "common/tests/test_common",
  "common/tests/test_file_helpers.py",
  "common/tests/test_numpy_fast.py",
  "common/tests/test_params.py",
  "common/tests/test_simple_kalman.py",
  "common/transformations/.gitignore",
  "common/transformations/README.md",
  "common/transformations/tests/",
  "common/transformations/tests/__init__.py",
  "common/transformations/tests/test_coordinates.py",
  "common/transformations/tests/test_orientation.py",
  "conftest.py",
  "Dockerfile.openpilot",
  "Dockerfile.openpilot_base",
  "docs/_static/",
  "docs/_static/favicon.ico",
  "docs/_static/logo.png",
  "docs/_static/robots.txt",
  "docs/assets/",
  "docs/assets/icon-star-empty.svg",
  "docs/assets/icon-star-full.svg",
  "docs/assets/icon-star-half.svg",
  "docs/assets/icon-youtube.svg",
  "docs/BOUNTIES.md",
  "docs/c_docs.rst",
  "docs/conf.py",
  "docs/index.md",
  "docs/Makefile",
  "docs/overview.rst",
  "docs/README.md",
  "docs/SAFETY.md",
  "docs/WORKFLOW.md",
  "opendbc/.pre-commit-config.yaml",
  "opendbc/bmw_e9x_e8x.dbc",
  "opendbc/cadillac_ct6_chassis.dbc",
  "opendbc/cadillac_ct6_object.dbc",
  "opendbc/cadillac_ct6_powertrain.dbc",
  "opendbc/can/tests/",
  "opendbc/can/tests/__init__.py",
  "opendbc/can/tests/.gitignore",
  "opendbc/can/tests/test_checksums.py",
  "opendbc/can/tests/test_dbc_exceptions.py",
  "opendbc/can/tests/test_dbc_parser.py",
  "opendbc/can/tests/test_define.py",
  "opendbc/can/tests/test_packer_parser.py",
  "opendbc/can/tests/test_parser_performance.py",
  "opendbc/can/tests/test.dbc",
  "opendbc/chrysler_cusw.dbc",
  "opendbc/Dockerfile",
  "opendbc/ESR.dbc",
  "opendbc/ford_cgea1_2_bodycan_2011.dbc",
  "opendbc/ford_cgea1_2_ptcan_2011.dbc",
  "opendbc/ford_fusion_2018_pt.dbc",
  "opendbc/gm_global_a_high_voltage_management.dbc",
  "opendbc/gm_global_a_lowspeed_1818125.dbc",
  "opendbc/gm_global_a_lowspeed.dbc",
  "opendbc/gm_global_a_powertrain_expansion.dbc",
  "opendbc/honda_fit_hybrid_2018_can_generated.dbc",
  "opendbc/honda_pilot_2023_can_generated.dbc",
  "opendbc/hyundai_2015_ccan.dbc",
  "opendbc/hyundai_2015_mcan.dbc",
  "opendbc/hyundai_i30_2014.dbc",
  "opendbc/hyundai_kia_mando_corner_radar_generated.dbc",
  "opendbc/hyundai_santafe_2007.dbc",
  "opendbc/LICENSE",
  "opendbc/luxgen_s5_2015.dbc",
  "opendbc/mazda_3_2019.dbc",
  "opendbc/mazda_radar.dbc",
  "opendbc/mazda_rx8.dbc",
  "opendbc/mercedes_benz_e350_2010.dbc",
  "opendbc/nissan_xterra_2011.dbc",
  "opendbc/opel_omega_2001.dbc",
  "opendbc/pyproject.toml",
  "opendbc/README.md",
  "opendbc/requirements.txt",
  "opendbc/SConstruct",
  "opendbc/site_scons/",
  "opendbc/site_scons/site_tools/",
  "opendbc/site_scons/site_tools/cython.py",
  "opendbc/tesla_model3_party.dbc",
  "opendbc/tesla_model3_vehicle.dbc",
  "opendbc/toyota_2017_ref_pt.dbc",
  "opendbc/toyota_iQ_2009_can.dbc",
  "opendbc/toyota_prius_2010_pt.dbc",
  "opendbc/toyota_radar_dsu_tssp.dbc",
  "opendbc/volvo_v40_2017_pt.dbc",
  "opendbc/volvo_v60_2015_pt.dbc",
  "panda/.pre-commit-config.yaml",
  "panda/Dockerfile",
  "panda/docs/",
  "panda/docs/CANPacket_structure.png",
  "panda/docs/USB_packet_structure.png",
  "panda/drivers/",
  "panda/drivers/linux/",
  "panda/drivers/linux/.gitignore",
  "panda/drivers/linux/dkms.conf",
  "panda/drivers/linux/Makefile",
  "panda/drivers/linux/panda.c",
  "panda/drivers/linux/README.md",
  "panda/drivers/linux/test/",
  "panda/drivers/linux/test/main.c",
  "panda/drivers/linux/test/Makefile",
  "panda/drivers/linux/test/run.sh",
  "panda/drivers/spi/",
  "panda/drivers/spi/.gitignore",
  "panda/drivers/spi/load.sh",
  "panda/drivers/spi/Makefile",
  "panda/drivers/spi/patch",
  "panda/drivers/spi/pull-src.sh",
  "panda/drivers/spi/spi_panda.h",
  "panda/drivers/spi/spidev_panda.c",
  "panda/LICENSE",
  "panda/mypy.ini",
  "panda/panda.png",
  "panda/pyproject.toml",
  "panda/README.md",
  "panda/requirements.txt",
  "panda/SConstruct",
  "panda/setup.cfg",
  "panda/setup.py",
  "panda/tests/",
  "panda/tests/__init__.py",
  "panda/tests/benchmark.py",
  "panda/tests/black_white_loopback_test.py",
  "panda/tests/black_white_relay_endurance.py",
  "panda/tests/black_white_relay_test.py",
  "panda/tests/bulk_write_test.py",
  "panda/tests/can_printer.py",
  "panda/tests/canfd/",
  "panda/tests/canfd/test_canfd.py",
  "panda/tests/check_fw_size.py",
  "panda/tests/ci_shell.sh",
  "panda/tests/debug_console.py",
  "panda/tests/development/",
  "panda/tests/development/register_hashmap_spread.py",
  "panda/tests/echo.py",
  "panda/tests/elm_car_simulator.py",
  "panda/tests/elm_throughput.py",
  "panda/tests/fan/",
  "panda/tests/fan/fan_test.py",
  "panda/tests/fan/fan_tuning.py",
  "panda/tests/get_version.py",
  "panda/tests/health_test.py",
  "panda/tests/hitl/",
  "panda/tests/hitl/__init__.py",
  "panda/tests/hitl/1_program.py",
  "panda/tests/hitl/2_health.py",
  "panda/tests/hitl/3_usb_to_can.py",
  "panda/tests/hitl/4_can_loopback.py",
  "panda/tests/hitl/5_spi.py",
  "panda/tests/hitl/6_safety.py",
  "panda/tests/hitl/7_internal.py",
  "panda/tests/hitl/8_misc.py",
  "panda/tests/hitl/9_harness.py",
  "panda/tests/hitl/conftest.py",
  "panda/tests/hitl/helpers.py",
  "panda/tests/hitl/known_bootstub/",
  "panda/tests/hitl/known_bootstub/bootstub_f4_first_dos_production.panda.bin",
  "panda/tests/hitl/known_bootstub/bootstub_f4_only_bcd.panda.bin",
  "panda/tests/hitl/known_bootstub/bootstub.panda_h7.bin",
  "panda/tests/hitl/reset_jungles.py",
  "panda/tests/hitl/run_parallel_tests.sh",
  "panda/tests/hitl/run_serial_tests.sh",
  "panda/tests/ir_test.py",
  "panda/tests/libpanda/",
  "panda/tests/libpanda/libpanda_py.py",
  "panda/tests/libpanda/libpanda.so",
  "panda/tests/libpanda/panda.c",
  "panda/tests/libpanda/safety_helpers.h",
  "panda/tests/libpanda/safety_helpers.py",
  "panda/tests/libpanda/SConscript",
  "panda/tests/libs/",
  "panda/tests/libs/resetter.py",
  "panda/tests/loopback_test.py",
  "panda/tests/message_drop_test.py",
  "panda/tests/misra/",
  "panda/tests/misra/.gitignore",
  "panda/tests/misra/coverage_table",
  "panda/tests/misra/install.sh",
  "panda/tests/misra/suppressions.txt",
  "panda/tests/misra/test_misra.sh",
  "panda/tests/misra/test_mutation.py",
  "panda/tests/read_flash_spi.py",
  "panda/tests/read_st_flash.sh",
  "panda/tests/read_winusb_descriptors.py",
  "panda/tests/reflash_internal_panda.py",
  "panda/tests/relay_test.py",
  "panda/tests/restore_flash_spi.py",
  "panda/tests/safety_replay/",
  "panda/tests/safety_replay/__init__.py",
  "panda/tests/safety_replay/.gitignore",
  "panda/tests/safety_replay/helpers.py",
  "panda/tests/safety_replay/replay_drive.py",
  "panda/tests/safety/",
  "panda/tests/safety/__init__.py",
  "panda/tests/safety/common.py",
  "panda/tests/safety/hyundai_common.py",
  "panda/tests/safety/test_body.py",
  "panda/tests/safety/test_chrysler.py",
  "panda/tests/safety/test_defaults.py",
  "panda/tests/safety/test_elm327.py",
  "panda/tests/safety/test_ford.py",
  "panda/tests/safety/test_gm.py",
  "panda/tests/safety/test_honda.py",
  "panda/tests/safety/test_hyundai_canfd.py",
  "panda/tests/safety/test_hyundai.py",
  "panda/tests/safety/test_mazda.py",
  "panda/tests/safety/test_nissan.py",
  "panda/tests/safety/test_subaru_preglobal.py",
  "panda/tests/safety/test_subaru.py",
  "panda/tests/safety/test_tesla.py",
  "panda/tests/safety/test_toyota.py",
  "panda/tests/safety/test_volkswagen_mqb.py",
  "panda/tests/safety/test_volkswagen_pq.py",
  "panda/tests/safety/test.sh",
  "panda/tests/setup_device_ci.sh",
  "panda/tests/som_debug.sh",
  "panda/tests/som/",
  "panda/tests/som/on-device.py",
  "panda/tests/som/test_bootkick.py",
  "panda/tests/spam_can.py",
  "panda/tests/standalone_test.py",
  "panda/tests/test_rsa.c",
  "panda/tests/usbprotocol/",
  "panda/tests/usbprotocol/test_comms.py",
  "panda/tests/usbprotocol/test_pandalib.py",
  "panda/tests/usbprotocol/test.sh",
  "poetry.lock",
  "rednose -> rednose_repo/rednose",
  "rednose_repo/.dockerignore",
  "rednose_repo/.editorconfig",
  "rednose_repo/.gitignore",
  "rednose_repo/.pre-commit-config.yaml",
  "rednose_repo/Dockerfile",
  "rednose_repo/examples/",
  "rednose_repo/examples/__init__.py",
  "rednose_repo/examples/kinematic_kf.png",
  "rednose_repo/examples/kinematic_kf.py",
  "rednose_repo/examples/live_kf.py",
  "rednose_repo/examples/SConscript",
  "rednose_repo/examples/test_compare.py",
  "rednose_repo/examples/test_kinematic_kf.py",
  "rednose_repo/LICENSE",
  "rednose_repo/pyproject.toml",
  "rednose_repo/README.md",
  "rednose_repo/rednose/",
  "rednose_repo/rednose/__init__.py",
  "rednose_repo/rednose/.gitignore",
  "rednose_repo/rednose/helpers/",
  "rednose_repo/rednose/helpers/__init__.py",
  "rednose_repo/rednose/helpers/chi2_lookup_table.npy",
  "rednose_repo/rednose/helpers/chi2_lookup.py",
  "rednose_repo/rednose/helpers/ekf_load.h",
  "rednose_repo/rednose/helpers/ekf_sym_pyx.cpp",
  "rednose_repo/rednose/helpers/ekf_sym_pyx.pyx",
  "rednose_repo/rednose/helpers/ekf_sym_pyx.so",
  "rednose_repo/rednose/helpers/ekf_sym.h",
  "rednose_repo/rednose/helpers/ekf_sym.py",
  "rednose_repo/rednose/helpers/ekf.h",
  "rednose_repo/rednose/helpers/kalmanfilter.py",
  "rednose_repo/rednose/helpers/sympy_helpers.py",
  "rednose_repo/rednose/logger/",
  "rednose_repo/rednose/logger/logger.h",
  "rednose_repo/rednose/SConscript",
  "rednose_repo/rednose/templates/",
  "rednose_repo/rednose/templates/compute_pos.c",
  "rednose_repo/rednose/templates/ekf_c.c",
  "rednose_repo/rednose/templates/feature_handler.c",
  "rednose_repo/requirements.txt",
  "rednose_repo/SConstruct",
  "rednose_repo/setup.py",
  "rednose_repo/site_scons/site_tools/cython.py",
  "SECURITY.md",
  "selfdrive/assets/compress-images.sh",
  "selfdrive/assets/strip-svg-metadata.sh",
  "selfdrive/boardd/tests/__init__.py",
  "selfdrive/boardd/tests/bootstub.panda_h7_spiv0.bin",
  "selfdrive/boardd/tests/bootstub.panda_h7.bin",
  "selfdrive/boardd/tests/bootstub.panda.bin",
  "selfdrive/boardd/tests/test_boardd_spi.py",
  "selfdrive/boardd/tests/test_boardd_usbprotocol",
  "selfdrive/boardd/tests/test_pandad.py",
  "selfdrive/car/CARS_template.md",
  "selfdrive/car/docs.py",
  "selfdrive/car/ford/tests/",
  "selfdrive/car/ford/tests/__init__.py",
  "selfdrive/car/ford/tests/print_platform_codes.py",
  "selfdrive/car/ford/tests/test_ford.py",
  "selfdrive/car/gm/tests/",
  "selfdrive/car/gm/tests/__init__.py",
  "selfdrive/car/gm/tests/test_gm.py",
  "selfdrive/car/honda/tests/",
  "selfdrive/car/honda/tests/__init__.py",
  "selfdrive/car/honda/tests/test_honda.py",
  "selfdrive/car/hyundai/tests/",
  "selfdrive/car/hyundai/tests/__init__.py",
  "selfdrive/car/hyundai/tests/print_platform_codes.py",
  "selfdrive/car/hyundai/tests/test_hyundai.py",
  "selfdrive/car/README.md",
  "selfdrive/car/subaru/tests/",
  "selfdrive/car/subaru/tests/test_subaru.py",
  "selfdrive/car/tests/.gitignore",
  "selfdrive/car/tests/big_cars_test.sh",
  "selfdrive/car/tests/routes.py",
  "selfdrive/car/tests/test_can_fingerprint.py",
  "selfdrive/car/tests/test_docs.py",
  "selfdrive/car/tests/test_fingerprints.py",
  "selfdrive/car/tests/test_fw_fingerprint.py",
  "selfdrive/car/tests/test_lateral_limits.py",
  "selfdrive/car/tests/test_models_segs.txt",
  "selfdrive/car/tests/test_models.py",
  "selfdrive/car/tests/test_platform_configs.py",
  "selfdrive/car/toyota/tests/",
  "selfdrive/car/toyota/tests/__init__.py",
  "selfdrive/car/toyota/tests/print_platform_codes.py",
  "selfdrive/car/toyota/tests/test_toyota.py",
  "selfdrive/car/volkswagen/tests/",
  "selfdrive/car/volkswagen/tests/test_volkswagen.py",
  "selfdrive/controls/.gitignore",
  "selfdrive/controls/lib/sunnypilot/tests/",
  "selfdrive/controls/lib/sunnypilot/tests/test_speed_limit_resolver.py",
  "selfdrive/controls/lib/tests/",
  "selfdrive/controls/lib/tests/__init__.py",
  "selfdrive/controls/lib/tests/test_alertmanager.py",
  "selfdrive/controls/lib/tests/test_latcontrol.py",
  "selfdrive/controls/lib/tests/test_vehicle_model.py",
  "selfdrive/controls/tests/",
  "selfdrive/controls/tests/__init__.py",
  "selfdrive/controls/tests/test_alerts.py",
  "selfdrive/controls/tests/test_cruise_speed.py",
  "selfdrive/controls/tests/test_following_distance.py",
  "selfdrive/controls/tests/test_lateral_mpc.py",
  "selfdrive/controls/tests/test_leads.py",
  "selfdrive/controls/tests/test_startup.py",
  "selfdrive/controls/tests/test_state_machine.py",
  "selfdrive/debug/__init__.py",
  "selfdrive/debug/adb.sh",
  "selfdrive/debug/can_print_changes.py",
  "selfdrive/debug/can_table.py",
  "selfdrive/debug/check_can_parser_performance.py",
  "selfdrive/debug/check_lag.py",
  "selfdrive/debug/check_timings.py",
  "selfdrive/debug/clear_dtc.py",
  "selfdrive/debug/count_events.py",
  "selfdrive/debug/cpu_usage_stat.py",
  "selfdrive/debug/cycle_alerts.py",
  "selfdrive/debug/debug_fw_fingerprinting_offline.py",
  "selfdrive/debug/dump_car_docs.py",
  "selfdrive/debug/fingerprint_from_route.py",
  "selfdrive/debug/internal/",
  "selfdrive/debug/internal/__init__.py",
  "selfdrive/debug/internal/fuzz_fw_fingerprint.py",
  "selfdrive/debug/internal/hands_on_wheel_moniotr.py",
  "selfdrive/debug/internal/measure_modeld_packet_drop.py",
  "selfdrive/debug/internal/measure_torque_time_to_max.py",
  "selfdrive/debug/internal/qlog_size.py",
  "selfdrive/debug/live_cpu_and_temp.py",
  "selfdrive/debug/print_docs_diff.py",
  "selfdrive/debug/print_flags.py",
  "selfdrive/debug/read_dtc_status.py",
  "selfdrive/debug/README.md",
  "selfdrive/debug/run_process_on_route.py",
  "selfdrive/debug/set_car_params.py",
  "selfdrive/debug/show_matching_cars.py",
  "selfdrive/debug/test_fw_query_on_routes.py",
  "selfdrive/debug/toyota_eps_factor.py",
  "selfdrive/locationd/test/",
  "selfdrive/locationd/test/__init__.py",
  "selfdrive/locationd/test/.gitignore",
  "selfdrive/locationd/test/test_calibrationd.py",
  "selfdrive/locationd/test/test_locationd_scenarios.py",
  "selfdrive/locationd/test/test_locationd.py",
  "selfdrive/modeld/models/dmonitoring_model.current",
  "selfdrive/modeld/models/dmonitoring_model.onnx",
  "selfdrive/modeld/models/README.md",
  "selfdrive/modeld/tests/",
  "selfdrive/modeld/tests/__init__.py",
  "selfdrive/modeld/tests/dmon_lag/",
  "selfdrive/modeld/tests/snpe_benchmark/",
  "selfdrive/modeld/tests/snpe_benchmark/.gitignore",
  "selfdrive/modeld/tests/snpe_benchmark/benchmark.sh",
  "selfdrive/modeld/tests/test_modeld.py",
  "selfdrive/modeld/tests/tf_test/",
  "selfdrive/modeld/tests/tf_test/build.sh",
  "selfdrive/modeld/tests/tf_test/pb_loader.py",
  "selfdrive/modeld/tests/timing/",
  "selfdrive/modeld/tests/timing/benchmark.py",
  "selfdrive/modeld/thneed/README",
  "selfdrive/monitoring/helpers.py",
  "selfdrive/monitoring/README.md",
  "selfdrive/monitoring/test_hands_monitoring.py",
  "selfdrive/monitoring/test_monitoring.py",
  "selfdrive/test/.gitignore",
  "selfdrive/test/ci_shell.sh",
  "selfdrive/test/ciui.py",
  "selfdrive/test/cpp_harness.py",
  "selfdrive/test/docker_build.sh",
  "selfdrive/test/docker_common.sh",
  "selfdrive/test/docker_tag_multiarch.sh",
  "selfdrive/test/longitudinal_maneuvers/",
  "selfdrive/test/longitudinal_maneuvers/__init__.py",
  "selfdrive/test/longitudinal_maneuvers/.gitignore",
  "selfdrive/test/longitudinal_maneuvers/maneuver.py",
  "selfdrive/test/longitudinal_maneuvers/plant.py",
  "selfdrive/test/longitudinal_maneuvers/test_accel.py",
  "selfdrive/test/longitudinal_maneuvers/test_longitudinal.py",
  "selfdrive/test/loop_until_fail.sh",
  "selfdrive/test/process_replay/",
  "selfdrive/test/process_replay/__init__.py",
  "selfdrive/test/process_replay/.gitignore",
  "selfdrive/test/process_replay/capture.py",
  "selfdrive/test/process_replay/compare_logs.py",
  "selfdrive/test/process_replay/imgproc_replay_ref_hash",
  "selfdrive/test/process_replay/migration.py",
  "selfdrive/test/process_replay/model_replay_ref_commit",
  "selfdrive/test/process_replay/model_replay.py",
  "selfdrive/test/process_replay/process_replay.py",
  "selfdrive/test/process_replay/README.md",
  "selfdrive/test/process_replay/ref_commit",
  "selfdrive/test/process_replay/regen_all.py",
  "selfdrive/test/process_replay/regen.py",
  "selfdrive/test/process_replay/test_fuzzy.py",
  "selfdrive/test/process_replay/test_imgproc.py",
  "selfdrive/test/process_replay/test_processes.py",
  "selfdrive/test/process_replay/test_regen.py",
  "selfdrive/test/process_replay/vision_meta.py",
  "selfdrive/test/profiling/",
  "selfdrive/test/profiling/__init__.py",
  "selfdrive/test/profiling/.gitignore",
  "selfdrive/test/profiling/lib.py",
  "selfdrive/test/profiling/profiler.py",
  "selfdrive/test/scons_build_test.sh",
  "selfdrive/test/setup_vsound.sh",
  "selfdrive/test/setup_xvfb.sh",
  "selfdrive/test/test_updated.py",
  "selfdrive/test/update_ci_routes.py",
  "selfdrive/ui/__init__.py",
  "selfdrive/ui/installer/continue_openpilot.sh",
  "selfdrive/ui/installer/installers/",
  "selfdrive/ui/installer/installers/installer_openpilot",
  "selfdrive/ui/installer/installers/installer_openpilot_internal",
  "selfdrive/ui/installer/installers/installer_openpilot_nightly",
  "selfdrive/ui/installer/installers/installer_openpilot_test",
  "selfdrive/ui/mui",
  "selfdrive/ui/qt/python_helpers.py",
  "selfdrive/ui/qt/setup/reset",
  "selfdrive/ui/qt/setup/setup",
  "selfdrive/ui/qt/setup/updater",
  "selfdrive/ui/tests/__init__.py",
  "selfdrive/ui/tests/.gitignore",
  "selfdrive/ui/tests/body.py",
  "selfdrive/ui/tests/create_test_translations.sh",
  "selfdrive/ui/tests/cycle_offroad_alerts.py",
  "selfdrive/ui/tests/test_soundd.py",
  "selfdrive/ui/tests/test_ui/",
  "selfdrive/ui/tests/test_ui/run.py",
  "selfdrive/ui/tests/test_ui/template.html",
  "selfdrive/ui/tests/ui_snapshot",
  "selfdrive/ui/translations/auto_translate.py",
  "selfdrive/ui/translations/create_badges.py",
  "selfdrive/ui/translations/README.md",
  "selfdrive/ui/ui.py",
  "selfdrive/ui/watch3",
  "teleoprtc -> teleoprtc_repo/teleoprtc",
  "teleoprtc_repo/",
  "teleoprtc_repo/.gitignore",
  "teleoprtc_repo/.pre-commit-config.yaml",
  "teleoprtc_repo/examples/",
  "teleoprtc_repo/examples/face_detection/",
  "teleoprtc_repo/examples/face_detection/face_detection.py",
  "teleoprtc_repo/examples/face_detection/README.md",
  "teleoprtc_repo/examples/videostream_cli/",
  "teleoprtc_repo/examples/videostream_cli/cli.py",
  "teleoprtc_repo/examples/videostream_cli/README.md",
  "teleoprtc_repo/LICENSE",
  "teleoprtc_repo/pyproject.toml",
  "teleoprtc_repo/README.md",
  "teleoprtc_repo/scripts/",
  "teleoprtc_repo/scripts/bump_tag.sh",
  "teleoprtc_repo/scripts/publish_pypi.sh",
  "teleoprtc_repo/teleoprtc/",
  "teleoprtc_repo/teleoprtc/__init__.py",
  "teleoprtc_repo/teleoprtc/builder.py",
  "teleoprtc_repo/teleoprtc/info.py",
  "teleoprtc_repo/teleoprtc/stream.py",
  "teleoprtc_repo/teleoprtc/tracks.py",
  "teleoprtc_repo/tests/",
  "teleoprtc_repo/tests/test_info.py",
  "teleoprtc_repo/tests/test_integration.py",
  "teleoprtc_repo/tests/test_stream.py",
  "teleoprtc_repo/tests/test_track.py",
  "third_party/acados/aarch64 -> larch64/",
  "third_party/acados/acados_template/.gitignore",
  "third_party/acados/build.sh",
  "third_party/acados/x86_64/",
  "third_party/acados/x86_64/lib/",
  "third_party/acados/x86_64/lib/libacados.so",
  "third_party/acados/x86_64/lib/libblasfeo.so",
  "third_party/acados/x86_64/lib/libhpipm.so",
  "third_party/acados/x86_64/lib/libqpOASES_e.so -> libqpOASES_e.so.3.1",
  "third_party/acados/x86_64/lib/libqpOASES_e.so.3.1",
  "third_party/acados/x86_64/t_renderer",
  "third_party/bootstrap/.gitignore",
  "third_party/catch2/",
  "third_party/catch2/include/",
  "third_party/catch2/include/catch2/",
  "third_party/catch2/include/catch2/catch_reporter_automake.hpp",
  "third_party/catch2/include/catch2/catch_reporter_sonarqube.hpp",
  "third_party/catch2/include/catch2/catch_reporter_tap.hpp",
  "third_party/catch2/include/catch2/catch_reporter_teamcity.hpp",
  "third_party/catch2/include/catch2/catch.hpp",
  "third_party/libyuv/.gitignore",
  "third_party/libyuv/aarch64 -> larch64/",
  "third_party/libyuv/build.sh",
  "third_party/libyuv/LICENSE",
  "third_party/libyuv/x86_64/",
  "third_party/libyuv/x86_64/include -> ../include",
  "third_party/libyuv/x86_64/lib/",
  "third_party/maplibre-native-qt/.gitignore",
  "third_party/snpe/x86_64 -> x86_64-linux-clang",
  "third_party/snpe/x86_64-linux-clang/",
  "third_party/snpe/x86_64-linux-clang/libHtpPrepare.so",
  "third_party/snpe/x86_64-linux-clang/libomp.so",
  "third_party/snpe/x86_64-linux-clang/libSNPE.so",
  "tinygrad -> tinygrad_repo/tinygrad",
  "tinygrad_repo/tinygrad/renderer/cuda.py",
  "tinygrad_repo/tinygrad/renderer/llvmir.py",
  "tinygrad_repo/tinygrad/renderer/metal.py",
  "tinygrad_repo/tinygrad/renderer/triton.py",
  "tinygrad_repo/tinygrad/renderer/wgsl.py",
  "tinygrad_repo/tinygrad/runtime/ops_clang.py",
  "tinygrad_repo/tinygrad/runtime/ops_cuda.py",
  "tinygrad_repo/tinygrad/runtime/ops_hip.py",
  "tinygrad_repo/tinygrad/runtime/ops_llvm.py",
  "tinygrad_repo/tinygrad/runtime/ops_metal.py",
  "tinygrad_repo/tinygrad/runtime/ops_shm.py",
  "tinygrad_repo/tinygrad/runtime/ops_torch.py",
  "tinygrad_repo/tinygrad/runtime/ops_webgpu.py",
]

# Merge the blacklists
blacklist += sunnypilot_blacklist

# gets you through the blacklist
whitelist = [
  "^tools/lib/(?!.*__pycache__).*$",
  "tools/bodyteleop/",

  "tinygrad_repo/openpilot/compile2.py",
  "tinygrad_repo/extra/onnx.py",
  "tinygrad_repo/extra/onnx_ops.py",
  "tinygrad_repo/extra/thneed.py",
  "tinygrad_repo/extra/utils.py",
  "tinygrad_repo/tinygrad/codegen/kernel.py",
  "tinygrad_repo/tinygrad/codegen/linearizer.py",
  "tinygrad_repo/tinygrad/features/image.py",
  "tinygrad_repo/tinygrad/features/search.py",
  "tinygrad_repo/tinygrad/nn/*",
  "tinygrad_repo/tinygrad/renderer/cstyle.py",
  "tinygrad_repo/tinygrad/renderer/opencl.py",
  "tinygrad_repo/tinygrad/runtime/lib.py",
  "tinygrad_repo/tinygrad/runtime/ops_cpu.py",
  "tinygrad_repo/tinygrad/runtime/ops_disk.py",
  "tinygrad_repo/tinygrad/runtime/ops_gpu.py",
  "tinygrad_repo/tinygrad/shape/*",
  "tinygrad_repo/tinygrad/.*.py",
]

if __name__ == "__main__":
  for f in Path(ROOT).rglob("**/*"):
    if not (f.is_file() or f.is_symlink()):
      continue

    rf = str(f.relative_to(ROOT))
    blacklisted = any(re.search(p, rf) for p in blacklist)
    whitelisted = any(re.search(p, rf) for p in whitelist)
    if blacklisted and not whitelisted:
      continue

    print(rf)
